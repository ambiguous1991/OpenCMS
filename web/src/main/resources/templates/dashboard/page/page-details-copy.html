<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="${@systemVariables.get(@varkey.PAGE_NAME)}+${breadcrumbTitle}">Failed</title>
    <div th:replace="/fragment/import"></div>
    <link rel="stylesheet" href="../../../static/css/opencms.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
          crossorigin="anonymous">
    <link rel="stylesheet" href="../../../static/css/bootstrap.css"/>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

</head>
<body class="d-flex flex-column vh-100">
<nav th:replace="/fragment/admin-navbar"></nav>
<nav th:replace="/fragment/admin-breadcrumb"></nav>
<div class="wrapper" style="max-height: 100vh;">
    <div th:replace="fragment/admin-sidebar"></div>
    <div class="container-fluid flex-column d-flex shadow-lg m-5 p-5">
        <meta name="csrf-token" th:content="${_csrf.getToken()}">
        <meta id="pageId" type="hidden" th:value="${page.getId()}">
        <script>
            $(document).ready(function () {
                $.ajaxSetup({
                    headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')}
                });

                $("#update-page").on("click", function () {
                    var request;
                    var editorValue = editor.getData();
                    var pageId = $('#pageId').val();
                    request = $.ajax({
                        type: "PUT",
                        url: '/dashboard/page/' + pageId + '/update',
                        data: {
                            content: editorValue
                        },
                        dataType: "json"
                    });
                });

                $("#preview").on("click", function () {
                    console.info("INSIDE MODAL");
                    var pageId = $('#pageId').val();
                    $('#modal-iframe').replaceWith(
                        '<iframe class="w-100 h-100" id="modal-iframe" src="/dashboard/page/' + pageId + '/preview">' + '</iframe>'
                    );
                    $('#preview-modal').modal();
                });
            })
        </script>

        <div class="d-flex flex-row">
            <div class=""><h2>Edycja strony <span th:text="${page.getTitle()}"></span></h2></div>
            <h2 class="text-right">
                <button id="preview" class="btn btn-sm btn-info">Podgląd</button>
                <button id="update-page" class="btn btn-sm btn-success">Zapisz postęp</button>
            </h2>
        </div>
        <div id="summernote" class="flex-grow-1"></div>
    </div>
</div>
</body>
</html>