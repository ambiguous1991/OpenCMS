<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="${@systemVariables.get(@varkey.PAGE_NAME)}+${breadcrumbTitle}">Failed</title>
    <div th:replace="/fragment/import"></div>
    <link rel="stylesheet" href="../../../static/css/opencms.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
          crossorigin="anonymous">
    <link rel="stylesheet" href="../../../static/css/bootstrap.css"/>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="https://cdn.ckeditor.com/4.11.4/standard/ckeditor.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<body class="d-flex flex-column vh-100">
<div id="modal-container">
    <div class="modal" id="preview-modal">
        <div class="modal-dialog modal-dialog-centered mw-100 mh-100" style="width:90%; max-height: 90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Pogląd strony</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div id="modal-body" class="modal-body">
                    <meta id="modal-iframe">
                </div>
            </div>
        </div>
    </div>
</div>
<nav th:replace="/fragment/admin-navbar"></nav>
<nav th:replace="/fragment/admin-breadcrumb"></nav>
<div class="wrapper" style="max-height: 100vh;">
    <meta name="csrf-token" th:content="${_csrf.getToken()}">

    <script>
        $(document).ready(function () {
            $.ajaxSetup({
                headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')}
            });

            $("#update-page").on("click", function () {
                var request;
                var editorValue = editor.getData();
                var pageId = $('#pageId').val();
                request = $.ajax({
                    type: "PUT",
                    url: '/dashboard/page/' + pageId + '/update',
                    data: {
                        content: editorValue
                    },
                    dataType: "json"
                });
            });

            $("#preview").on("click", function () {
                console.info("INSIDE MODAL");
                var pageId = $('#pageId').val();
                $('#modal-iframe').replaceWith(
                    '<iframe class="w-100 h-100" id="modal-iframe" src="/dashboard/page/'+pageId+'/preview">'+'</iframe>'
                );
                $('#preview-modal').modal();
            });
        })
    </script>

    <div class="container-fluid flex-column d-flex shadow-lg m-5 p-5">
        <div class="row mb-4">
            <div class="col-sm-8"><h2>Edycja strony <span th:text="${page.getTitle()}"></span></h2></div>
            <h2 class="col-sm-4 text-right">
                <button id="preview" class="btn btn-sm btn-info">Podgląd</button>
                <button id="update-page" class="btn btn-sm btn-success">Zapisz postęp</button>
            </h2>
        </div>
        <form class="flex-grow-1 d-flex flex-column" method="post"
              th:action="'/dashboard/page/'+${page.getId()}+'/edit'">
            <input id="page-initial-content" type="hidden" th:value="${page.content}"/>
            <textarea name="editor1" class="border" id="page-contents"></textarea>
            <script>
                var editor = CKEDITOR.replace('editor1', {
                    customConfig: '/js/ckeditor-config.js'
                });
                editor.setData($('#page-initial-content').val());
            </script>
            <input id="pageId" type="hidden" th:value="${page.getId()}"/>
        </form>
    </div>
</div>
</body>
</html>