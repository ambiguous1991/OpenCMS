<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="${@systemVariables.get(@varkey.PAGE_NAME)}+${breadcrumbTitle}">Failed</title>
    <div th:replace="/fragment/import"></div>
    <link rel="stylesheet" href="../../../static/css/opencms.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
          crossorigin="anonymous">
    <link rel="stylesheet" href="../../../static/css/bootstrap.css"/>
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.11.4/standard/ckeditor.js"></script>
</head>
<body class="d-flex flex-column vh-100">
<nav th:replace="/fragment/admin-navbar"></nav>
<nav th:replace="/fragment/admin-breadcrumb"></nav>
<div class="wrapper" style="max-height: 100vh;">
    <meta name="csrf-token" th:content="${_csrf.getToken()}">
    <script>
        $(document).ready(function () {
            $.ajaxSetup({
                headers:{ 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content') }
            });

            $("#update-page").on("click", function () {
                var request;
                var editorValue = editor.getData();
                var pageId = $('#pageId').val();
                request = $.ajax({
                    type: "PUT",
                    url: '/dashboard/page/'+pageId+'/update',
                    data: {
                        content: editorValue
                    },
                    dataType: "json"
                });
            });
        })
    </script>

    <div class="container-fluid flex-column d-flex shadow-lg m-5 p-5">
        <div class="row mb-4">
            <div class="col-sm-8"><h2>Edycja strony <span th:text="${page.getTitle()}"></span></h2></div>
            <h2 class="col-sm-4 text-right">
                <button id="update-page" name="submit" type="submit" class="btn btn-sm btn-primary">Zapisz postÄ™p
                </button>
            </h2>
        </div>
        <form class="flex-grow-1 d-flex flex-column" method="post"
              th:action="'/dashboard/page/'+${page.getId()}+'/edit'">
            <input id="page-initial-content" type="hidden" th:value="${page.content}"/>
            <textarea name="editor1" class="border" id="page-contents"></textarea>
            <script>
                var editor = CKEDITOR.replace('editor1', {
                    customConfig: '/js/ckeditor-config.js'
                });
                editor.setData($('#page-initial-content').val());
            </script>
            <input id="pageId" type="hidden" th:value="${page.getId()}"/>
        </form>
    </div>
</div>
</body>
</html>